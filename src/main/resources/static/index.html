<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<link rel="stylesheet"
			href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
			integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
			crossorigin="anonymous">

	<title>Google Sign-In Demo</title>
</head>
<body>
<div class="container-fluid">
	<div class="row justify-content-start m-4">
		<div class="col-auto m-3" style="width: 25rem;">

			<div class="card" style="min-height: 10rem;">
				<h4 class="card-header">Sign Up</h4>
				<form id="signup-form" class="p-3 ">

					<div class="form-group">
						<label for="full-name">Full Name</label>
						<input type="text" class="form-control" id="full-name" placeholder="John Smith">
					</div>

					<div class="form-group">
						<label for="email-signup">Email</label>
						<input type="email" class="form-control" id="email-signup" placeholder="jsmith@example.com">
					</div>

					<div class="form-group">
						<label for="password-signup">Password</label>
						<input type="password" class="form-control" id="password-signup">
					</div>

					<div class="form-row">
						<div class="col-7">
							<button type="submit" class="btn btn-primary">Sign Up</button>
							<span class="ml-1">or simple use </span>
						</div>

						<div class="col-5">
							<button id="google-signup" type="button" class="btn btn-outline-primary">Google</button>
						</div>
					</div>
					<div id="error-signup" class="mt-2 small"></div>
				</form>
			</div>

		</div>

	</div>
</div>

<script>
	window.onload = () => {
		gapi.auth2.init({
			client_id: '165605455122-3ng8bglg5rbsnjb0di51gckne5nhr84b.apps.googleusercontent.com',
			cookiepolicy: 'single_host_origin',
		});

		$("#signup-form").submit(async(event) => {
			event.preventDefault();
			let response = await fetch("http://localhost:8080/users/me/signup", {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json;charset=utf-8'
				},
				body: JSON.stringify({
					name: $("#full-name").val(),
					email: $("#email-signup").val(),
					password: $("#password-signup").val()
				})
			});

			if (response.ok) {
				let location = response.headers.get('Location');
				$("#error-signup").text("Location: " + location).removeClass("text-danger").addClass("text-info").show();
			} else {
				let json = await response.json();
				let message = json.message;
				let error = json.error;
				$("#error-signup").text(error + ": " + message).removeClass("text-info").addClass("text-danger").show();
			}
		});

		$("#google-signup").click(() => {
			gapi.auth2.getAuthInstance().signIn({
				prompt: 'select_account'
			}).then(googleUser => {
				let profile = googleUser.getBasicProfile();
				console.log("ID: " + profile.getId());
				console.log('Full Name: ' + profile.getName());
				console.log('Given Name: ' + profile.getGivenName());
				console.log('Family Name: ' + profile.getFamilyName());
				console.log("Image URL: " + profile.getImageUrl());
				console.log("Email: " + profile.getEmail());

				let id_token = googleUser.getAuthResponse().id_token;
				console.log("ID Token: " + id_token);
			});
		});
	};
</script>

<script src="https://apis.google.com/js/api:client.js"></script>

<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
		  integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
		  crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
		  integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
		  crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
		  integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
		  crossorigin="anonymous"></script>
</body>
</html>